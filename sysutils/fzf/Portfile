# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0
PortGroup           github 1.0

version             0.13.5
github.setup        junegunn fzf ${version}

categories          sysutils
platforms           darwin
license             MIT

maintainers         gmail.com:intact79 \
                    openmaintainer
description         command-line fuzzy finder
long_description    fzf is a general-purpose command-line fuzzy finder.

homepage            https://github.com/junegunn/fzf

depends_build       port:go
use_configure       no
dist_subdir         go

checksums           fzf-${version}.tar.gz \
                        md5     12476799201018260b435790741d9cd1 \
                        sha1    b26f7daae69ab40ee73fd06dda901e198a8e0fb2 \
                        sha256  2739454ca9a35a4e9eeadb356c16f2a57b25cd473caa9f85e7442a934e94e7c7

# dependencies to build. remember revbump when you change version of dependencies.
set go-runewidth.version    63c378b851290989b19ca955468386485f118c65
set go-shellwords.version   35d512af75e283aae4ca1fc3d44b159ed66189a4
# dependencies
master_sites-append https://github.com/junegunn/go-runewidth/tarball/${go-runewidth.version}:go-runewidth \
                    https://github.com/junegunn/go-shellwords/tarball/${go-shellwords.version}:go-shellwords
distfiles-append    junegunn-go-runewidth-${go-runewidth.version}.tar.gz:go-runewidth \
                    junegunn-go-shellwords-${go-shellwords.version}.tar.gz:go-shellwords
checksums-append    junegunn-go-runewidth-${go-runewidth.version}.tar.gz \
                        md5     77a5a798f5c3fe09f8cb7d12e218e560 \
                        sha1    51ec9fa4ea78bd5396911983c5823cbdf8a43682 \
                        sha256  3fe70d2ca6d4cbfd22613bed09c5abc8f374f5c38f148e4f3729612f0da3f87a \
                    junegunn-go-shellwords-${go-shellwords.version}.tar.gz \
                        md5     c5bbe751a0bb3a129c982af11fee54bb \
                        sha1    b1b09307f20dd1dd4ef34db12eb2c0a7b85447a2 \
                        sha256  1ed25ce85eeb8fe378450f94125d0c9ea21ad6ac2202e2ac544ba2779ee07f36

set gopath          ${workpath}/GOPATH
post-extract {
    file mkdir ${gopath}/src/github.com/junegunn/fzf
    ln -s ${worksrcpath}/src ${gopath}/src/github.com/junegunn/fzf/src
    move [glob ${workpath}/junegunn-go-runewidth-*] ${gopath}/src/github.com/junegunn/go-runewidth
    move [glob ${workpath}/junegunn-go-shellwords-*] ${gopath}/src/github.com/junegunn/go-shellwords
}

build.cmd           go
build.target        build
build.args          -a -ldflags -w -tags \"\" -o bin/fzf src/fzf/main.go
build.env           GOPATH="${gopath}"

destroot {
    # Install fzf, fzf-tmux
    xinstall ${worksrcpath}/bin/fzf ${destroot}${prefix}/bin
    xinstall ${worksrcpath}/bin/fzf-tmux ${destroot}${prefix}/bin

    # Documentation
    xinstall -d ${destroot}${prefix}/share/doc/${name}
    xinstall -m 644 -W ${worksrcpath} README.md LICENSE CHANGELOG.md \
        ${destroot}${prefix}/share/doc/${name}

    # Man pages
    xinstall -d ${destroot}${prefix}/share/man/man1
    xinstall -m 644 {*}[glob ${worksrcpath}/man/man1/*.1] \
        ${destroot}${prefix}/share/man/man1

    # Install shell completion and key-bindings
    xinstall -d ${destroot}${prefix}/share/${name}/shell
    xinstall -m 644 {*}[glob ${worksrcpath}/shell/*] \
        ${destroot}${prefix}/share/${name}/shell

    # Install vim plugin
    xinstall -d ${destroot}${prefix}/share/${name}/plugin
    xinstall -m 644 {*}[glob ${worksrcpath}/plugin/*] \
        ${destroot}${prefix}/share/${name}/plugin
}
